<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>[.LRI.] Citizenship!</title>
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="//handsontable.com/dist/handsontable.full.js"></script>
    <link rel="stylesheet" media="screen" href="//handsontable.com/dist/handsontable.full.css">  </head>
    <link rel="stylesheet" media="screen" href="hot.css">
  <body>
    <div id="spreadsheet" class="htColumnHeaders"></div>
    <script>
    var data = [
      {
        image: "http://image.eveonline.com/Type/2204_64.png",
        blueprint: "Acolyte I",
        me: "10",
        te: "20",
        copies: "Yes",
        t2: "Yes",
        price: "100,000 ISK",
        t2price: "400,000 ISK"
      },
      {
        image: "http://image.eveonline.com/Type/2174_64.png",
        blueprint: "Infiltrator I",
        me: "10",
        te: "20",
        copies: "Yes",
        t2: "Yes",
        price: "200,000 ISK",
        t2price: "500,000 ISK"
      }
    ],
    container,
    hot;

var container = document.getElementById('spreadsheet');
var hot = new Handsontable(container, {
  data: data,
  colWidths: [74, 200, 64, 64, 100, 100, 200, 200],
  colHeaders: ["", "Blueprint", "ME", "TE", "Copies", "T2", "Price", "Price (T2)"],
  rowHeaders: true,
  currentRowClassName: 'currentrow',
  columns: [
    {data: "image", renderer: coverRenderer},
    {data: "blueprint", renderer: safeHtmlRenderer},
    {data: "me", renderer: safeHtmlRenderer},
    {data: "te", renderer: safeHtmlRenderer},
    {data: "copies", renderer: safeHtmlRenderer},
    {data: "t2", renderer: safeHtmlRenderer},
    {data: "price", renderer: safeHtmlRenderer},
    {data: "t2price", renderer: safeHtmlRenderer}
  ],
  editor: false,
  readonly: true,
  fillHandle: false
});
function strip_tags(input, allowed) {
   var tags = /<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,
     commentsAndPhpTags = /<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;

   // making sure the allowed arg is a string containing only tags in lowercase (<a><b><c>)
   allowed = (((allowed || "") + "").toLowerCase().match(/<[a-z][a-z0-9]*>/g) || []).join('');

   return input.replace(commentsAndPhpTags, '').replace(tags, function ($0, $1) {
     return allowed.indexOf('<' + $1.toLowerCase() + '>') > -1 ? $0 : '';
   });
 }
function safeHtmlRenderer(instance, td, row, col, prop, value, cellProperties) {
   var escaped = Handsontable.helper.stringify(value);
   escaped = strip_tags(escaped, '<em><b><strong><a><big>'); //be sure you only allow certain HTML tags to avoid XSS threats (you should also remove unwanted HTML attributes)
   td.innerHTML = escaped;

   return td;
 }
 function coverRenderer (instance, td, row, col, prop, value, cellProperties) {
    var escaped = Handsontable.helper.stringify(value),
      img;

    if (escaped.indexOf('http') === 0) {
      img = document.createElement('IMG');
      img.src = value;

      Handsontable.Dom.addEvent(img, 'mousedown', function (e){
        e.preventDefault(); // prevent selection quirk
      });

      Handsontable.Dom.empty(td);
      td.appendChild(img);
    }
    else {
      // render as text
      Handsontable.renderers.TextRenderer.apply(this, arguments);
    }

    return td;
  }
</script>
  </body>
  </html>
